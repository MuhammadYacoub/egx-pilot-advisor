# ูุธุงู ุงูุจูุงูุงุช ุงููุงููุฉ ุงูุญููููุฉ - EGX Pilot Advisor

## ูุธุฑุฉ ุนุงูุฉ

ุชู ุชุทููุฑ ูุธุงู ุดุงูู ูุฌูุจ ูุฅุฏุงุฑุฉ ุงูุจูุงูุงุช ุงููุงููุฉ ุงูุญููููุฉ ููุฃุณูู ุงููุตุฑูุฉ ูู ุงูุจูุฑุตุฉ ุงููุตุฑูุฉ (EGX). ูุนุชูุฏ ุงููุธุงู ุนูู Yahoo Finance ููุตุฏุฑ ุฑุฆูุณู ูุน ุฅููุงููุฉ ุงูุชูุณุน ููุตุงุฏุฑ ุฃุฎุฑู ูุณุชูุจูุงู.

## ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ

### 1. ูุงุนุฏุฉ ุจูุงูุงุช ุงูุฃุณูู ุงููุตุฑูุฉ
- **ุงูููู**: `backend/src/data/egx-stocks.json`
- **ุงููุญุชูู**: 105+ ุณูู ูุตุฑู ูุน ุงูุฃุณูุงุก ูุงูุฑููุฒ ุงูุตุญูุญุฉ
- **ุงูุชุญุฏูุซ**: ูุงุจู ููุชุญุฏูุซ ูุงูุชูุณุน

### 2. ุฎุฏูุฉ ุงูุจูุงูุงุช ุงูุชุงุฑูุฎูุฉ
- **ุงูููู**: `backend/src/services/historical-data.service.ts`
- **ุงููุธุงุฆู**:
  - ุฌูุจ ุงูุจูุงูุงุช ุงูุชุงุฑูุฎูุฉ ุจุดูู ุชููุงุฆู
  - ุญูุธ ุงูุจูุงูุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
  - ุชุญุฏูุซ cache ุงูุณูู
  - ุงุญุตุงุฆูุงุช ุดุงููุฉ

### 3. ุฎุฏูุฉ ุงูุจุญุซ ุงููุญุณูุฉ
- **ุชุญุณูู**: `yahoo-finance.service.ts`
- **ุงูุจุญุซ**: ุจุงูุงุณู ุงูุนุฑุจู ูุงูุฅูุฌููุฒู ูุงูุฑูุฒ
- **ุงููุชุงุฆุฌ**: ุฏูููุฉ ููุญุฏุซุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงููุญููุฉ

### 4. API endpoints ุฌุฏูุฏุฉ
- **ุงูููู**: `backend/src/routes/market.routes.ts`
- **ุงููุณุงุฑุงุช**:
  - `GET /api/market/historical/:symbol` - ุงูุจูุงูุงุช ุงูุชุงุฑูุฎูุฉ
  - `GET /api/market/quote/:symbol` - ุงูุณุนุฑ ุงูุญุงูู
  - `GET /api/market/search` - ุงูุจุญุซ ุนู ุงูุฃุณูู
  - `GET /api/market/top-movers` - ุงูุฃุณูู ุงูุฃูุซุฑ ุญุฑูุฉ
  - `POST /api/market/populate-data` - ุฌูุจ ุงูุจูุงูุงุช (dev only)
  - `GET /api/market/stats` - ุงุญุตุงุฆูุงุช ุงูุจูุงูุงุช
  - `POST /api/market/update-active` - ุชุญุฏูุซ ุงูุจูุงูุงุช

### 5. ุณูุฑููพุชุงุช ุฅุฏุงุฑูุฉ
- **ุฌูุจ ุงูุจูุงูุงุช**: `npm run populate-data [1y|2y]`
- **ุชุญุฏูุซ ุงูุณูู**: `npm run update-market`

## ุงูุจูุงูุงุช ุงููุชููุฑุฉ

### ุฃุณูู ุงูุจูุฑุตุฉ ุงููุตุฑูุฉ (105+ ุณูู)
```
ุงูุจููู: COMI, QNBE, HDBK, CIEB, ADIB, FAIT
ุงูุชุทููุฑ ุงูุนูุงุฑู: PHDC, TMGH, MASR, EMFD, OCDI
ุงูุงุชุตุงูุงุช ูุงูุชูููููุฌูุง: ETEL, FWRY, EFIH
ุงูุตูุงุนุงุช: SWDY, ESRS, GBCO, IRON
ุงูุฃุฏููุฉ: ISPH, SPMD, RMDA, PHAR
```

### ุงูุจูุงูุงุช ุงูุชุงุฑูุฎูุฉ
- **ุงููุชุฑุงุช**: 1 ุณูุฉ ุฃู 2 ุณูุฉ
- **ุงูุชูุงุตูู**: ุณุนุฑ ุงููุชุญุ ุงูุฅุบูุงูุ ุงูุฃุนููุ ุงูุฃุฏููุ ุงูุญุฌู
- **ุงูุชุญุฏูุซ**: ูููู ููุจูุงูุงุช ุงูุฌุฏูุฏุฉ

### ุจูุงูุงุช ุงูุณูู ุงูุญุงููุฉ
- **ุงูุณุนุฑ ุงูุญุงูู** ูุน ุงูุชุบููุฑ ุงููููู
- **ุงูุญุฌู** ูุงูุฃุญุฌุงู ุงููุชูุณุทุฉ
- **ูุนูููุงุช ุงูุดุฑูุฉ** ูุงููุทุงุน
- **Cache ุฐูู** ูุชุญุณูู ุงูุฃุฏุงุก

## ููููุฉ ุงูุงุณุชุฎุฏุงู

### 1. ุฌูุจ ุงูุจูุงูุงุช ุงูุชุงุฑูุฎูุฉ (ุฃูู ูุฑุฉ)
```bash
cd backend
npm run populate-data 1y    # ุณูุฉ ูุงุญุฏุฉ
npm run populate-data 2y    # ุณูุชุงู
```

### 2. ุชุญุฏูุซ ุจูุงูุงุช ุงูุณูู
```bash
cd backend
npm run update-market
```

### 3. ุงุณุชุฎุฏุงู API
```javascript
// ุงูุจุญุซ ุนู ุณูู
GET /api/market/search?q=Commercial

// ุฌูุจ ุงูุณุนุฑ ุงูุญุงูู
GET /api/market/quote/COMI

// ุงูุจูุงูุงุช ุงูุชุงุฑูุฎูุฉ
GET /api/market/historical/COMI?period=1y&source=db

// ุงุญุตุงุฆูุงุช ุงูุจูุงูุงุช
GET /api/market/stats
```

### 4. ูู ุงููุงุฌูุฉ ุงูุฃูุงููุฉ
```typescript
// ูู services/market.service.ts
const historicalData = await fetch('/api/market/historical/COMI?period=1y');
const quote = await fetch('/api/market/quote/COMI');
const searchResults = await fetch('/api/market/search?q=ุจูู');
```

## ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุงูุฌุฏุงูู ุงููุณุชุฎุฏูุฉ
- **HistoricalData**: ุงูุจูุงูุงุช ุงูุชุงุฑูุฎูุฉ ุงูููููุฉ
- **MarketDataCache**: cache ุงูุจูุงูุงุช ุงูุญุงููุฉ
- **TechnicalIndicator**: ุงููุคุดุฑุงุช ุงููููุฉ (ูููุณุชูุจู)
- **FundamentalData**: ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ (ูููุณุชูุจู)

### ูุซุงู ุนูู ุงูุจูุงูุงุช
```sql
-- ุงูุจูุงูุงุช ุงูุชุงุฑูุฎูุฉ
SELECT symbol, dateTime, closePrice, volume 
FROM historical_data 
WHERE symbol = 'COMI' 
ORDER BY dateTime DESC 
LIMIT 30;

-- Cache ุงูุณูู
SELECT symbol, companyName, currentPrice, priceChangePercent 
FROM market_data_cache 
WHERE isActive = 1 
ORDER BY priceChangePercent DESC;
```

## ุงูุฃุฏุงุก ูุงูููุงุกุฉ

### ุงูุชุฎุฒูู ุงููุคูุช (Caching)
- **ุงูุจูุงูุงุช ุงูุญุงููุฉ**: 30 ุซุงููุฉ ุฃุซูุงุก ุงูุชุฏุงููุ 5 ุฏูุงุฆู ุฎุงุฑุฌู
- **ุงูุจูุงูุงุช ุงูุชุงุฑูุฎูุฉ**: 5 ุฏูุงุฆู
- **ูุชุงุฆุฌ ุงูุจุญุซ**: ููุฑูุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงููุญููุฉ

### ุฅุฏุงุฑุฉ ุงูุทูุจุงุช
- **Rate Limiting**: ูุญุชุฑู ูู Yahoo Finance
- **Batch Processing**: ูุนุงูุฌุฉ ุงูุฃุณูู ูู ูุฌููุนุงุช
- **Error Handling**: ุชุฌุงูู ุงูุฃุฎุทุงุก ููุชุงุจุนุฉ ุงูุนูููุฉ

### ุงูููุซูููุฉ
- **Fallback**: ุฌูุจ ูู cache ูู ุญุงูุฉ ูุดู API
- **Retry Logic**: ุฅุนุงุฏุฉ ุงููุญุงููุฉ ุนูุฏ ุงููุดู
- **Data Validation**: ุงูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช

## ุงููุฑุงูุจุฉ ูุงูุตูุงูุฉ

### ุงูุฅุญุตุงุฆูุงุช ุงููุชููุฑุฉ
```javascript
GET /api/market/stats
{
  "totalHistoricalRecords": 50000,
  "uniqueSymbols": 105,
  "marketCacheEntries": 98,
  "dateRange": {
    "oldest": "2023-07-04",
    "newest": "2024-07-04"
  }
}
```

### ุงูุณุฌูุงุช (Logs)
- ุฌูุจ ุงูุจูุงูุงุช ุงูุชุงุฑูุฎูุฉ ูุน ุชูุฑูุฑ ููุตู
- ุชุญุฏูุซ cache ุงูุณูู ูุน ุงููุชุงุฆุฌ
- ุฃุฎุทุงุก API ูุน ุงูุชูุงุตูู
- ุงุญุตุงุฆูุงุช ุงูุฃุฏุงุก

### ุงูููุงู ุงูุฏูุฑูุฉ ุงูููุชุฑุญุฉ
1. **ููููุงู**: `npm run update-market` (ุฎุงุฑุฌ ุณุงุนุงุช ุงูุชุฏุงูู)
2. **ุฃุณุจูุนูุงู**: ูุญุต ุงุญุตุงุฆูุงุช ุงูุจูุงูุงุช
3. **ุดูุฑูุงู**: ุชุญุฏูุซ ูุงุฆูุฉ ุงูุฃุณูู ูู ุงููุฑููุงุช ุงูุฌุฏูุฏุฉ

## ุงูุฎุทูุงุช ุงูุชุงููุฉ

### ุงูุชุญุณููุงุช ุงูููุชุฑุญุฉ
1. **ุฅุถุงูุฉ ูุตุงุฏุฑ ุจูุงูุงุช ุจุฏููุฉ** (Fallback sources)
2. **Web Scraping** ููุจูุฑุตุฉ ุงููุตุฑูุฉ ุงูุฑุณููุฉ
3. **ุงููุคุดุฑุงุช ุงููููุฉ** ุงููุญุณูุจุฉ ุชููุงุฆูุงู
4. **ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ** ููุดุฑูุงุช
5. **API ููุฃุฎุจุงุฑ ุงููุงููุฉ**

### ุงูุชูุงูู ูุน ุงููุงุฌูุฉ ุงูุฃูุงููุฉ
1. **ูููู ุงูุจุญุซ ุงููุญุณู** ูุน ุงูุชุฑุงุญุงุช ููุฑูุฉ
2. **ุฑุณูู ุจูุงููุฉ ุชูุงุนููุฉ** ููุจูุงูุงุช ุงูุชุงุฑูุฎูุฉ
3. **ููุญุฉ ููุงุฏุฉ** ููุฑุงูุจุฉ ุงูุจูุงูุงุช
4. **ุฅุนุฏุงุฏุงุช ุงููุณุชุฎุฏู** ููุชุญุฏูุซ ุงูุชููุงุฆู

---

## ููุงุญุธุงุช ูููุฉ

โ๏ธ **ุชูุจูู**: ุนูููุฉ ุฌูุจ ุงูุจูุงูุงุช ุงูุชุงุฑูุฎูุฉ ูุฃูู ูุฑุฉ ูุฏ ุชุณุชุบุฑู 30-60 ุฏูููุฉ ูุฌููุน ุงูุฃุณูู.

๐ก **ูุตูุญุฉ**: ุดุบู `npm run populate-data` ุฎุงุฑุฌ ุณุงุนุงุช ุงูุชุฏุงูู ูุชุฌูุจ ุงูุชุฃุซูุฑ ุนูู ุงูุฃุฏุงุก.

๐ **ุชุญุฏูุซ**: ุงุณุชุฎุฏู `npm run update-market` ุจุงูุชุธุงู ููุญุตูู ุนูู ุฃุญุฏุซ ุงูุฃุณุนุงุฑ.

๐ **ูุฑุงูุจุฉ**: ุฑุงุฌุน `/api/market/stats` ุจุงูุชุธุงู ููุชุงุจุนุฉ ุญุงูุฉ ุงูุจูุงูุงุช.

---

**ุชุงุฑูุฎ ุงูุฅูุดุงุก**: 4 ููููู 2025  
**ุขุฎุฑ ุชุญุฏูุซ**: 4 ููููู 2025  
**ุงูุญุงูุฉ**: ุฌุงูุฒ ููุงุณุชุฎุฏุงู โ
